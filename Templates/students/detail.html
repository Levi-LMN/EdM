{% extends 'base.html' %}

{% block title %}{{ student.full_name }} - EduManage Pro{% endblock %}
{% block page_title %}{{ student.full_name }}{% endblock %}

{% block page_actions %}
<a href="{{ url_for('students.list') }}" class="btn btn-outline-primary">
    <i class="fas fa-arrow-left me-2"></i>Back
</a>
<a href="{{ url_for('students.edit', student_id=student.id) }}" class="btn btn-outline-warning">
    <i class="fas fa-edit me-2"></i>Edit
</a>
<a href="{{ url_for('payments.add', student_id=student.id) }}" class="btn btn-success">
    <i class="fas fa-money-bill-wave me-2"></i>Record Payment
</a>
<div class="dropdown d-inline-block">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="fas fa-ellipsis-v"></i>
    </button>
    <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{{ url_for('fees.assess') }}?student_id={{ student.id }}">
            <i class="fas fa-file-invoice me-2"></i>Assess Fees
        </a></li>
        <li><a class="dropdown-item" href="#" onclick="printStudentCard()">
            <i class="fas fa-print me-2"></i>Print Student Card
        </a></li>
        <li><hr class="dropdown-divider"></li>
        {% if student.is_active %}
        <li>
            <form method="POST" action="{{ url_for('students.deactivate', student_id=student.id) }}"
                  onsubmit="return confirm('Deactivate this student?');">
                <button type="submit" class="dropdown-item text-warning">
                    <i class="fas fa-user-slash me-2"></i>Deactivate Student
                </button>
            </form>
        </li>
        {% else %}
        <li>
            <form method="POST" action="{{ url_for('students.reactivate', student_id=student.id) }}">
                <button type="submit" class="dropdown-item text-success">
                    <i class="fas fa-user-check me-2"></i>Reactivate Student
                </button>
            </form>
        </li>
        {% endif %}
    </ul>
</div>
{% endblock %}

{% block content %}
<!-- Status Banner -->
{% if not student.is_active %}
<div class="alert alert-warning mb-4">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Inactive Student:</strong> This student account is currently deactivated.
</div>
{% endif %}

<!-- Student Header Card -->
<div class="card mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="card-body text-white">
        <div class="row align-items-center">
            <div class="col-md-2 text-center">
                <div class="rounded-circle bg-white d-inline-flex align-items-center justify-content-center"
                     style="width: 100px; height: 100px;">
                    <i class="fas fa-user-graduate fa-3x" style="color: #667eea;"></i>
                </div>
            </div>
            <div class="col-md-6">
                <h3 class="mb-2">{{ student.full_name }}</h3>
                <p class="mb-1">
                    <i class="fas fa-id-card me-2"></i>
                    <strong>Admission No:</strong> {{ student.admission_no }}
                </p>
                <p class="mb-1">
                    <i class="fas fa-school me-2"></i>
                    <strong>Class:</strong> {{ student.class_obj.name }}
                    {% if student.stream %}
                        <span class="badge bg-light text-dark ms-2">{{ student.stream.name }}</span>
                    {% endif %}
                </p>
                <p class="mb-0">
                    <i class="fas fa-calendar me-2"></i>
                    <strong>Joined:</strong> {{ student.admission_date.strftime('%B %Y') }}
                </p>
            </div>
            <div class="col-md-4">
                <div class="text-end">
                    <div class="mb-2">
                        <span class="badge bg-{{ 'success' if student.student_type.value == 'DAY' else 'warning' }}"
                              style="font-size: 1rem; padding: 0.5rem 1rem;">
                            {{ student.student_type.value }}
                        </span>
                    </div>
                    {% set balance = balance_summary.overall_balance %}
                    <div class="p-3 bg-white bg-opacity-25 rounded">
                        <small class="d-block text-white-50">Current Balance</small>
                        <h2 class="mb-0 {% if balance > 0 %}text-warning{% else %}text-white{% endif %}">
                            {{ balance|currency }}
                        </h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Tabs -->
<ul class="nav nav-tabs mb-4" id="studentTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab"
                data-bs-target="#overview" type="button">
            <i class="fas fa-info-circle me-2"></i>Overview
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="financial-tab" data-bs-toggle="tab"
                data-bs-target="#financial" type="button">
            <i class="fas fa-wallet me-2"></i>Financial
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="payments-tab" data-bs-toggle="tab"
                data-bs-target="#payments" type="button">
            <i class="fas fa-receipt me-2"></i>Payments
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="history-tab" data-bs-toggle="tab"
                data-bs-target="#history" type="button">
            <i class="fas fa-history me-2"></i>History
        </button>
    </li>
</ul>

<div class="tab-content" id="studentTabsContent">
    <!-- Overview Tab -->
    <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <div class="row">
            <!-- Personal Information -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-user me-2"></i>Personal Information
                        </h6>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td width="40%" class="text-muted">Full Name</td>
                                <td><strong>{{ student.full_name }}</strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Date of Birth</td>
                                <td>
                                    {% if student.date_of_birth %}
                                        {{ student.date_of_birth.strftime('%B %d, %Y') }}
                                    {% else %}
                                        <span class="text-muted">Not provided</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Admission Date</td>
                                <td>{{ student.admission_date.strftime('%B %d, %Y') }}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Status</td>
                                <td>
                                    {% if student.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-user-friends me-2"></i>Parent/Guardian Contact
                        </h6>
                    </div>
                    <div class="card-body">
                        {% if student.parent_name or student.parent_phone or student.parent_email %}
                        <table class="table table-borderless mb-0">
                            {% if student.parent_name %}
                            <tr>
                                <td width="40%" class="text-muted">Name</td>
                                <td><strong>{{ student.parent_name }}</strong></td>
                            </tr>
                            {% endif %}
                            {% if student.parent_phone %}
                            <tr>
                                <td class="text-muted">Phone</td>
                                <td>
                                    <i class="fas fa-phone me-2 text-primary"></i>
                                    <a href="tel:{{ student.parent_phone }}">{{ student.parent_phone }}</a>
                                    <button class="btn btn-sm btn-outline-primary ms-2"
                                            onclick="copyToClipboard('{{ student.parent_phone }}')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endif %}
                            {% if student.parent_email %}
                            <tr>
                                <td class="text-muted">Email</td>
                                <td>
                                    <i class="fas fa-envelope me-2 text-primary"></i>
                                    <a href="mailto:{{ student.parent_email }}">{{ student.parent_email }}</a>
                                </td>
                            </tr>
                            {% endif %}
                        </table>
                        <div class="mt-3">
                            <button class="btn btn-sm btn-outline-primary" onclick="sendSMS()">
                                <i class="fas fa-sms me-2"></i>Send SMS
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="sendEmail()">
                                <i class="fas fa-envelope me-2"></i>Send Email
                            </button>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-user-slash fa-2x text-muted mb-2"></i>
                            <p class="text-muted mb-0">No parent information available</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Transport Information -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-bus me-2"></i>Transport Details
                        </h6>
                    </div>
                    <div class="card-body">
                        {% if student.vehicle or student.transport_distance_km %}
                        <table class="table table-borderless mb-0">
                            {% if student.vehicle %}
                            <tr>
                                <td width="40%" class="text-muted">Vehicle</td>
                                <td>
                                    <strong>{{ student.vehicle.registration_number }}</strong><br>
                                    <small class="text-muted">{{ student.vehicle.route_description }}</small>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Driver</td>
                                <td>
                                    {{ student.vehicle.driver_name or 'Not assigned' }}<br>
                                    {% if student.vehicle.driver_phone %}
                                    <small><i class="fas fa-phone me-1"></i>{{ student.vehicle.driver_phone }}</small>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}
                            {% if student.transport_distance_km %}
                            <tr>
                                <td class="text-muted">Distance</td>
                                <td><strong>{{ student.transport_distance_km }} km</strong> from school</td>
                            </tr>
                            {% endif %}
                        </table>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-bus-slash fa-2x text-muted mb-2"></i>
                            <p class="text-muted mb-0">No transport assigned</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="col-md-6 mb-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Quick Statistics
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <i class="fas fa-file-invoice-dollar fa-2x text-primary mb-2"></i>
                                    <h5 class="mb-0">{{ current_assessments|length }}</h5>
                                    <small class="text-muted">Current Assessments</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <i class="fas fa-receipt fa-2x text-success mb-2"></i>
                                    <h5 class="mb-0">{{ recent_payments|length }}</h5>
                                    <small class="text-muted">Total Payments</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 border rounded">
                                    <i class="fas fa-calendar-check fa-2x text-info mb-2"></i>
                                    <h5 class="mb-0">-</h5>
                                    <small class="text-muted">Years in School</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 border rounded">
                                    <i class="fas fa-percentage fa-2x text-warning mb-2"></i>
                                    <h5 class="mb-0">
                                        {% if balance_summary.total_assessed > 0 %}
                                            {{ ((balance_summary.total_payments / balance_summary.total_assessed) * 100)|round(1) }}%
                                        {% else %}
                                            0%
                                        {% endif %}
                                    </h5>
                                    <small class="text-muted">Payment Rate</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Tab -->
    <div class="tab-pane fade" id="financial" role="tabpanel">
        <!-- Balance Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card text-center" style="border-left: 4px solid #667eea;">
                    <div class="card-body">
                        <i class="fas fa-file-invoice-dollar fa-3x text-primary mb-3"></i>
                        <h6 class="text-muted">Total Assessed</h6>
                        <h3 class="mb-0">{{ balance_summary.total_assessed|currency }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-center" style="border-left: 4px solid #48bb78;">
                    <div class="card-body">
                        <i class="fas fa-hand-holding-usd fa-3x text-success mb-3"></i>
                        <h6 class="text-muted">Total Paid</h6>
                        <h3 class="mb-0">{{ balance_summary.total_payments|currency }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-center" style="border-left: 4px solid {{ '#f56565' if balance_summary.overall_balance > 0 else '#48bb78' }};">
                    <div class="card-body">
                        <i class="fas fa-balance-scale fa-3x text-{{ 'danger' if balance_summary.overall_balance > 0 else 'success' }} mb-3"></i>
                        <h6 class="text-muted">Balance Due</h6>
                        <h3 class="mb-0 text-{{ 'danger' if balance_summary.overall_balance > 0 else 'success' }}">
                            {{ balance_summary.overall_balance|currency }}
                        </h3>
                        {% if balance_summary.overall_balance > 0 %}
                        <small class="text-danger">Outstanding</small>
                        {% else %}
                        <small class="text-success">Cleared</small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Term Breakdown -->
        {% if balance_summary.term_balances %}
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>Balance by Term
                </h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Term/Year</th>
                                <th class="text-end">Assessed</th>
                                <th class="text-end">Paid</th>
                                <th class="text-end">Balance</th>
                                <th class="text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for term_balance in balance_summary.term_balances %}
                            <tr>
                                <td>
                                    <strong>Term {{ term_balance.term }}</strong><br>
                                    <small class="text-muted">{{ term_balance.year }}</small>
                                </td>
                                <td class="text-end">{{ term_balance.assessed|currency }}</td>
                                <td class="text-end text-success">{{ term_balance.paid|currency }}</td>
                                <td class="text-end">
                                    <strong class="text-{{ 'danger' if term_balance.balance > 0 else 'success' }}">
                                        {{ term_balance.balance|currency }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    {% if term_balance.balance <= 0 %}
                                    <span class="badge bg-success">
                                        <i class="fas fa-check me-1"></i>Cleared
                                    </span>
                                    {% elif term_balance.paid / term_balance.assessed > 0.75 %}
                                    <span class="badge bg-info">
                                        <i class="fas fa-hourglass-half me-1"></i>Almost Done
                                    </span>
                                    {% elif term_balance.paid / term_balance.assessed > 0.5 %}
                                    <span class="badge bg-warning">
                                        <i class="fas fa-exclamation-triangle me-1"></i>Partial
                                    </span>
                                    {% else %}
                                    <span class="badge bg-danger">
                                        <i class="fas fa-times me-1"></i>Outstanding
                                    </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <th>Total</th>
                                <th class="text-end">{{ balance_summary.total_assessed|currency }}</th>
                                <th class="text-end">{{ balance_summary.total_payments|currency }}</th>
                                <th class="text-end">{{ balance_summary.overall_balance|currency }}</th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Current Year Assessments -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="fas fa-file-invoice me-2"></i>Current Year Fee Assessments
                </h6>
                <a href="{{ url_for('fees.assess') }}?student_id={{ student.id }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus me-1"></i>Assess Fees
                </a>
            </div>
            <div class="card-body">
                {% if current_assessments %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Fee Item</th>
                                <th>Term</th>
                                <th>Description</th>
                                <th class="text-end">Amount</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for assessment in current_assessments %}
                            <tr>
                                <td>
                                    <i class="fas fa-tag me-2 text-primary"></i>
                                    <strong>{{ assessment.fee_item.name }}</strong>
                                </td>
                                <td><span class="badge bg-info">Term {{ assessment.term }}</span></td>
                                <td><small>{{ assessment.description }}</small></td>
                                <td class="text-end"><strong>{{ assessment.amount|currency }}</strong></td>
                                <td><small>{{ assessment.assessed_date.strftime('%b %d, %Y') }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="3"><strong>Total Assessed</strong></td>
                                <td class="text-end">
                                    <strong class="text-primary">
                                        {{ current_assessments|sum(attribute='amount')|currency }}
                                    </strong>
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-file-invoice fa-3x text-muted mb-3"></i>
                    <p class="text-muted mb-3">No fee assessments for the current year</p>
                    <a href="{{ url_for('fees.assess') }}?student_id={{ student.id }}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Create Assessment
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Payments Tab -->
    <div class="tab-pane fade" id="payments" role="tabpanel">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="fas fa-receipt me-2"></i>Payment History
                </h6>
                <a href="{{ url_for('payments.add', student_id=student.id) }}" class="btn btn-sm btn-success">
                    <i class="fas fa-plus me-1"></i>Record Payment
                </a>
            </div>
            <div class="card-body">
                {% if recent_payments %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Receipt No</th>
                                <th>Payment Mode</th>
                                <th>Reference</th>
                                <th class="text-end">Amount</th>
                                <th>Processed By</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in recent_payments %}
                            <tr>
                                <td>{{ payment.payment_date.strftime('%b %d, %Y') }}</td>
                                <td><strong>{{ payment.receipt_number }}</strong></td>
                                <td>
                                    <span class="badge bg-{{ 'success' if payment.payment_mode.value == 'MPESA' else 'secondary' }}">
                                        {{ payment.payment_mode.value }}
                                    </span>
                                </td>
                                <td>
                                    <small>
                                        {% if payment.mpesa_code %}
                                            {{ payment.mpesa_code }}
                                        {% elif payment.bank_slip_number %}
                                            {{ payment.bank_slip_number }}
                                        {% elif payment.cheque_number %}
                                            {{ payment.cheque_number }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                                <td class="text-end">
                                    <strong class="text-success">{{ payment.amount|currency }}</strong>
                                </td>
                                <td>
                                    <small>
                                        {% if payment.processor %}
                                            {{ payment.processor.name }}
                                        {% else %}
                                            -
                                        {% endif %}
                                    </small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="4"><strong>Total Payments</strong></td>
                                <td class="text-end">
                                    <strong class="text-success">
                                        {{ recent_payments|sum(attribute='amount')|currency }}
                                    </strong>
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                    <p class="text-muted mb-3">No payment records yet</p>
                    <a href="{{ url_for('payments.add', student_id=student.id) }}" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>Record First Payment
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- History Tab -->
    <div class="tab-pane fade" id="history" role="tabpanel">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-history me-2"></i>Student Activity History
                </h6>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6 class="mb-1">Student Admitted</h6>
                            <small class="text-muted">{{ student.admission_date.strftime('%B %d, %Y') }}</small>
                            <p class="mb-0 mt-2">
                                Student was admitted to {{ student.class_obj.name }}
                                {% if student.stream %}({{ student.stream.name }}){% endif %}
                            </p>
                        </div>
                    </div>
                    <!-- Add more timeline items for promotions, etc. -->
                </div>
                <div class="text-center mt-4">
                    <p class="text-muted">Complete activity history coming soon</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Danger Zone -->
<div class="card border-danger mt-4">
    <div class="card-header bg-danger text-white">
        <h6 class="mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
        </h6>
    </div>
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h6>Delete Student Record</h6>
                <p class="text-muted mb-0">
                    Permanently delete this student and all associated records. This action cannot be undone and is only available if the student has no payment or assessment records.
                </p>
            </div>
            <div class="col-md-4 text-end">
                <form method="POST"
                      action="{{ url_for('students.delete', student_id=student.id) }}"
                      onsubmit="return confirm('Are you absolutely sure you want to delete {{ student.full_name }}? This action cannot be undone!');">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i>Delete Permanently
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    padding-bottom: 30px;
    border-left: 2px solid #e0e0e0;
}

.timeline-item:last-child {
    border-left: 2px solid transparent;
}

.timeline-marker {
    position: absolute;
    left: -6px;
    top: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.timeline-content {
    margin-left: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 12px;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-tabs .nav-link {
    border: none;
    border-bottom: 3px solid transparent;
    color: #666;
    font-weight: 500;
}

.nav-tabs .nav-link:hover {
    border-bottom-color: #667eea;
    color: #667eea;
}

.nav-tabs .nav-link.active {
    border-bottom-color: #667eea;
    color: #667eea;
    background: transparent;
}

@media print {
    .btn, .nav-tabs, .card-header .btn, .dropdown {
        display: none !important;
    }
}
</style>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('Copied to clipboard: ' + text);
    }, function() {
        alert('Failed to copy');
    });
}

function sendSMS() {
    const phone = '{{ student.parent_phone }}';
    if (phone) {
        const message = encodeURIComponent('Hello, this is a message from EduManage Pro regarding {{ student.full_name }}.');
        window.location.href = `sms:${phone}?body=${message}`;
    } else {
        alert('No phone number available');
    }
}

function sendEmail() {
    const email = '{{ student.parent_email }}';
    if (email) {
        const subject = encodeURIComponent('Regarding {{ student.full_name }}');
        const body = encodeURIComponent('Dear {{ student.parent_name }},\n\n');
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    } else {
        alert('No email address available');
    }
}

function printStudentCard() {
    window.print();
}

// Auto-save tab selection
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('#studentTabs button[data-bs-toggle="tab"]');
    const lastTab = localStorage.getItem('studentDetailTab');

    if (lastTab) {
        const tabToActivate = document.querySelector(`#studentTabs button[data-bs-target="${lastTab}"]`);
        if (tabToActivate) {
            new bootstrap.Tab(tabToActivate).show();
        }
    }

    tabs.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function(e) {
            localStorage.setItem('studentDetailTab', e.target.getAttribute('data-bs-target'));
        });
    });
});
</script>
{% endblock %}