{% extends "base.html" %}

{% block title %}Reports & Analytics - EduManage Pro{% endblock %}

{% block page_title %}Reports & Analytics{% endblock %}

{% block page_actions %}
<a href="{{ url_for('download_all_data') }}" class="btn btn-success">
    <i class="fas fa-download me-2"></i>Download All Data
</a>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Quick Stats -->
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-user-graduate fa-3x mb-3" style="color: #667eea;"></i>
                <h3 class="mb-0">{{ Student.query.filter_by(is_active=True).count() }}</h3>
                <p class="text-muted mb-0">Active Students</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-credit-card fa-3x mb-3" style="color: #48bb78;"></i>
                <h3 class="mb-0">{{ Payment.query.count() }}</h3>
                <p class="text-muted mb-0">Total Payments</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-bus fa-3x mb-3" style="color: #f59e0b;"></i>
                <h3 class="mb-0">{{ Vehicle.query.filter_by(is_active=True).count() }}</h3>
                <p class="text-muted mb-0">Active Vehicles</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-receipt fa-3x mb-3" style="color: #ef4444;"></i>
                <h3 class="mb-0">{{ Expense.query.count() }}</h3>
                <p class="text-muted mb-0">Total Expenses</p>
            </div>
        </div>
    </div>
</div>

<!-- Financial Reports -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-dollar-sign me-2"></i>Financial Reports
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-file-invoice-dollar fa-2x" style="color: #667eea;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Fee Collection Summary</h6>
                        <p class="text-muted small mb-2">Overview of all fee collections by term/year</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_fee_collection_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('view_fee_collection_report') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle fa-2x" style="color: #f59e0b;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Outstanding Balances</h6>
                        <p class="text-muted small mb-2">Students with pending fee payments</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_outstanding_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('outstanding_fees_report') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-history fa-2x" style="color: #10b981;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Payment History</h6>
                        <p class="text-muted small mb-2">Complete payment transactions log</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_payment_history') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('payment_list') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-receipt fa-2x" style="color: #ef4444;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Expense Report</h6>
                        <p class="text-muted small mb-2">Detailed breakdown of all expenses</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_expense_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('expense_list') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Student Reports -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-user-graduate me-2"></i>Student Reports
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-list-ul fa-2x" style="color: #667eea;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Complete Student Register</h6>
                        <p class="text-muted small mb-2">All students with full details</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_student_register') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('student_list') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-graduation-cap fa-2x" style="color: #8b5cf6;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Students by Class</h6>
                        <p class="text-muted small mb-2">Class-wise student breakdown with tabs</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_students_by_class') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('class_summary_report') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-chart-bar fa-2x" style="color: #06b6d4;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Student Balance Statements</h6>
                        <p class="text-muted small mb-2">Individual fee statements for all students</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_all_student_statements') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-user-check fa-2x" style="color: #10b981;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Boarders vs Day Students</h6>
                        <p class="text-muted small mb-2">Analysis by student type</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_student_type_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Transport Reports -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-bus me-2"></i>Transport Reports
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-bus-alt fa-2x" style="color: #f59e0b;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Vehicle Revenue Report</h6>
                        <p class="text-muted small mb-2">Revenue analysis per vehicle</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_vehicle_revenue') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('vehicle_revenue_report') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-route fa-2x" style="color: #3b82f6;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Transport Assignments</h6>
                        <p class="text-muted small mb-2">All students using transport</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_transport_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Academic Reports -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-calendar-alt me-2"></i>Academic Reports
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-level-up-alt fa-2x" style="color: #8b5cf6;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Promotion History</h6>
                        <p class="text-muted small mb-2">Student promotions and class changes</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_promotion_report') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('promotion_management') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <div class="d-flex align-items-center p-3 border rounded">
                    <div class="flex-shrink-0">
                        <i class="fas fa-chart-pie fa-2x" style="color: #ec4899;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="mb-1">Class Summary Report</h6>
                        <p class="text-muted small mb-2">Overview of all classes and streams</p>
                        <div class="btn-group btn-group-sm" role="group">
                            <a href="{{ url_for('download_class_summary') }}" class="btn btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Excel
                            </a>
                            <a href="{{ url_for('class_summary_report') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Report Generator -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-cog me-2"></i>Custom Report Generator
        </h5>
    </div>
    <div class="card-body">
        <form action="{{ url_for('generate_custom_report') }}" method="POST">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Report Type</label>
                        <select name="report_type" class="form-select" required>
                            <option value="">Select Type...</option>
                            <option value="students">Students</option>
                            <option value="payments">Payments</option>
                            <option value="assessments">Fee Assessments</option>
                            <option value="expenses">Expenses</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Date Range</label>
                        <select name="date_range" class="form-select">
                            <option value="all">All Time</option>
                            <option value="current_year">Current Year</option>
                            <option value="current_term">Current Term</option>
                            <option value="last_month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-download me-2"></i>Generate Report
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Add loading state to download buttons
    $('a[href*="download"]').on('click', function() {
        const btn = $(this);
        const originalHtml = btn.html();
        btn.html('<i class="fas fa-spinner fa-spin me-1"></i>Generating...');
        btn.addClass('disabled');

        // Re-enable after 5 seconds
        setTimeout(function() {
            btn.html(originalHtml);
            btn.removeClass('disabled');
        }, 5000);
    });
});
</script>
{% endblock %}