{% extends "base.html" %}

{% block title %}Add Fee Item - EduManage Pro{% endblock %}

{% block page_title %}Add Fee Item{% endblock %}

{% block page_actions %}
<a href="{{ url_for('fee_management') }}" class="btn btn-outline-primary">
    <i class="fas fa-arrow-left me-2"></i>Back to Fee Management
</a>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 col-xl-6 mx-auto">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tag me-2"></i>
                    Fee Item Information
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Fee Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required
                                       placeholder="e.g., Tuition Fee">
                                <div class="form-text">Descriptive name for this fee type</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="code" class="form-label">Fee Code <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="code" name="code" required
                                       placeholder="e.g., TUITION" style="text-transform: uppercase;">
                                <div class="form-text">Unique code (will be converted to uppercase)</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"
                                  placeholder="Optional description of this fee item..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="scope" class="form-label">Fee Scope <span class="text-danger">*</span></label>
                                <select class="form-select" id="scope" name="scope" required onchange="updateScopeHelp()">
                                    <option value="">Select scope...</option>
                                    <option value="{{ FeeScope.UNIVERSAL.value }}">Universal - All Students</option>
                                    <option value="{{ FeeScope.CLASS_LEVEL.value }}">Class Level - Per Class</option>
                                    <option value="{{ FeeScope.STREAM_LEVEL.value }}">Stream Level - Per Stream</option>
                                    <option value="{{ FeeScope.INDIVIDUAL.value }}">Individual - Manually Assigned</option>
                                </select>
                                <div id="scope-help" class="form-text">Select how this fee applies to students</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="is_per_km" name="is_per_km" onchange="updatePerKmHelp()">
                                    <label class="form-check-label" for="is_per_km">
                                        <strong>Distance-based Fee</strong>
                                    </label>
                                </div>
                                <div id="perkm-help" class="form-text">Check if this fee is calculated per kilometer (transport fees)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Fee Examples Section -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb me-2"></i>Common Fee Examples:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Universal Fees:</strong>
                                <ul class="mb-0">
                                    <li>Registration Fee</li>
                                    <li>Activity Fee</li>
                                    <li>ID Card Fee</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <strong>Class/Stream Fees:</strong>
                                <ul class="mb-0">
                                    <li>Tuition Fee</li>
                                    <li>Lab Fee</li>
                                    <li>Books & Materials</li>
                                </ul>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <strong>Individual Fees:</strong>
                                <ul class="mb-0">
                                    <li>Transport Fee (per km)</li>
                                    <li>Swimming Fee</li>
                                    <li>Special Coaching</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Create Fee Item
                        </button>
                        <a href="{{ url_for('fee_management') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function updateScopeHelp() {
        const scope = document.getElementById('scope').value;
        const helpDiv = document.getElementById('scope-help');

        const helpTexts = {
            'UNIVERSAL': 'This fee applies to ALL students in the school',
            'CLASS_LEVEL': 'This fee applies to all students in specific classes (e.g., Form 1, Form 2)',
            'STREAM_LEVEL': 'This fee applies to all students in specific streams (e.g., Form 1A, Form 1B)',
            'INDIVIDUAL': 'This fee is manually assigned to individual students as needed'
        };

        helpDiv.textContent = helpTexts[scope] || 'Select how this fee applies to students';
    }

    function updatePerKmHelp() {
        const isPerKm = document.getElementById('is_per_km').checked;
        const helpDiv = document.getElementById('perkm-help');

        if (isPerKm) {
            helpDiv.innerHTML = '<strong>Distance-based:</strong> Fee will be calculated as (rate Ã— distance in km)';
            helpDiv.className = 'form-text text-primary';
        } else {
            helpDiv.textContent = 'Check if this fee is calculated per kilometer (transport fees)';
            helpDiv.className = 'form-text';
        }
    }

    // Auto-generate code from name
    document.getElementById('name').addEventListener('input', function() {
        const name = this.value;
        const code = name.replace(/[^a-zA-Z0-9]/g, '_').toUpperCase();
        document.getElementById('code').value = code;
    });
</script>
{% endblock %}