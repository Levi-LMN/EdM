{% extends "base.html" %}

{% block title %}Record Expense - EduManage Pro{% endblock %}
{% block page_title %}Record New Expense{% endblock %}

{% block page_actions %}
<a href="{{ url_for('expenses.list') }}" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-2"></i>Back to Expenses
</a>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-plus-square me-2"></i>Expense Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('expenses.add') }}">
                    <div class="row">
                        <!-- Category -->
                        <div class="col-md-6 mb-3">
                            <label for="category_id" class="form-label">Category <span class="text-danger">*</span></label>
                            <select name="category_id" id="category_id" class="form-select" required>
                                <option value="">Select Category</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }} ({{ category.code }})</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">
                                Don't see your category? <a href="{{ url_for('expenses.add_category') }}" target="_blank">Add one here</a>
                            </small>
                        </div>

                        <!-- Expense Date -->
                        <div class="col-md-6 mb-3">
                            <label for="expense_date" class="form-label">Expense Date <span class="text-danger">*</span></label>
                            <input type="date" name="expense_date" id="expense_date" class="form-control"
                                   value="{{ today }}" max="{{ today }}" required>
                        </div>

                        <!-- Description -->
                        <div class="col-12 mb-3">
                            <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea name="description" id="description" class="form-control" rows="3"
                                      placeholder="Enter detailed description of the expense" required></textarea>
                        </div>

                        <!-- Amount -->
                        <div class="col-md-6 mb-3">
                            <label for="amount" class="form-label">Amount (KES) <span class="text-danger">*</span></label>
                            <input type="number" name="amount" id="amount" class="form-control"
                                   step="0.01" min="0.01" placeholder="0.00" required>
                        </div>

                        <!-- Payment Method -->
                        <div class="col-md-6 mb-3">
                            <label for="payment_method" class="form-label">Payment Method</label>
                            <select name="payment_method" id="payment_method" class="form-select">
                                <option value="">Select Payment Method</option>
                                <option value="CASH">Cash</option>
                                <option value="MPESA">M-Pesa</option>
                                <option value="BANK">Bank Transfer</option>
                                <option value="CHEQUE">Cheque</option>
                            </select>
                        </div>

                        <!-- Reference Number -->
                        <div class="col-md-6 mb-3">
                            <label for="reference_number" class="form-label">Reference Number</label>
                            <input type="text" name="reference_number" id="reference_number" class="form-control"
                                   placeholder="Transaction ID, Receipt No, etc.">
                            <small class="text-muted">M-Pesa code, bank reference, or receipt number</small>
                        </div>

                        <!-- Supplier Name -->
                        <div class="col-md-6 mb-3">
                            <label for="supplier_name" class="form-label">Supplier/Vendor Name</label>
                            <input type="text" name="supplier_name" id="supplier_name" class="form-control"
                                   placeholder="Name of supplier or vendor">
                        </div>

                        <!-- Approved By -->
                        <div class="col-12 mb-3">
                            <label for="approved_by" class="form-label">Approved By</label>
                            <input type="text" name="approved_by" id="approved_by" class="form-control"
                                   placeholder="Name of person who approved this expense">
                        </div>

                        <!-- Notes -->
                        <div class="col-12 mb-3">
                            <label for="notes" class="form-label">Additional Notes</label>
                            <textarea name="notes" id="notes" class="form-control" rows="2"
                                      placeholder="Any additional information or comments"></textarea>
                        </div>
                    </div>

                    <!-- Summary Box -->
                    <div class="alert alert-info mb-3">
                        <h6 class="mb-2"><i class="fas fa-info-circle me-2"></i>Summary</h6>
                        <div class="d-flex justify-content-between">
                            <span>Total Expense Amount:</span>
                            <strong id="summaryAmount">KES 0.00</strong>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('expenses.list') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Record Expense
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Tips Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Quick Tips</h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li class="mb-2">Always include detailed descriptions for easy tracking</li>
                    <li class="mb-2">Save receipt numbers and transaction references</li>
                    <li class="mb-2">Record expenses on the same day when possible</li>
                    <li>Use the correct category for accurate reporting</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Set today's date as default
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('expense_date');
    if (!dateInput.value) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;
    }
});

// Update summary when amount changes
document.getElementById('amount').addEventListener('input', function() {
    const amount = parseFloat(this.value) || 0;
    document.getElementById('summaryAmount').textContent =
        'KES ' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const amount = parseFloat(document.getElementById('amount').value);
    if (amount <= 0) {
        e.preventDefault();
        alert('Please enter a valid amount greater than 0');
        return false;
    }
});
</script>
{% endblock %}